<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Linux System Programming [2]: File Input/Output • Rocky's Tech Blog</title>
    <meta name="description" content="리눅스 시스템 프로그래밍 [2]: 파일 입출력">
    <meta name="keywords" content="">
    
    	<!-- Twitter Cards -->
	<meta name="twitter:title" content="Linux System Programming [2]: File Input/Output">
	<meta name="twitter:description" content="리눅스 시스템 프로그래밍 [2]: 파일 입출력">
	
	<meta name="twitter:creator" content="@">
	
	<meta name="twitter:card" content="summary">
	<meta name="twitter:image" content="http://localhost:4000/images/git_icon.png">
	
	<!-- Open Graph -->
	<meta property="og:locale" content="en">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Linux System Programming [2]: File Input/Output">
	<meta property="og:description" content="리눅스 시스템 프로그래밍 [2]: 파일 입출력">
	<meta property="og:url" content="http://localhost:4000/book/linux_system_programming_2/">
	<meta property="og:site_name" content="Rocky's Tech Blog">

    <link rel="canonical" href="http://localhost:4000/book/linux_system_programming_2/">

    <link href="http://localhost:4000/atom.xml" type="application/atom+xml" rel="alternate" title="Rocky's Tech Blog Atom Feed">
    <link href="http://localhost:4000/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">

    <link rel="stylesheet" href="http://localhost:4000/css/main.css">
    <!-- HTML5 Shiv and Media Query Support for IE -->
    <!--[if lt IE 9]>
      <script src="http://localhost:4000/js/vendor/html5shiv.min.js"></script>
      <script src="http://localhost:4000/js/vendor/respond.min.js"></script>
    <![endif]-->

  </head>

  <body id="js-body">
    <!--[if lt IE 9]><div class="upgrade notice-warning"><strong>Your browser is quite old!</strong> Why not <a href="http://whatbrowser.org/">upgrade to a newer one</a> to better enjoy this site?</div><![endif]-->

    <header id="masthead">
  <div class="inner-wrap">
    <a href="http://localhost:4000/" class="site-title">Rocky's Tech Blog</a>
    <nav role="navigation" class="menu top-menu">
        <ul class="menu-item">
	<li class="home"><a href="/">Rocky's Tech Blog</a></li>
	
    
    <li><a href="http://localhost:4000/about/" >About Me</a></li>
  
    
    <li><a href="http://localhost:4000" > </a></li>
  
    
    <li><a href="http://localhost:4000/research/" >Research</a></li>
  
    
    <li><a href="http://localhost:4000/book/" >Book</a></li>
  
    
    <li><a href="http://localhost:4000/whatever/" >Whatever</a></li>
  
</ul>
    </nav>
  </div><!-- /.inner-wrap -->
</header><!-- /.masthead -->
    <nav role="navigation" id="js-menu" class="sliding-menu-content">
  <h5>Rocky's Tech Blog <span>Table of Contents</span></h5>
  <ul class="menu-item">
    <li>
      <a href="http://localhost:4000/about/">
        <img src="http://localhost:4000/images/rocky_icon.png" alt="teaser" class="teaser">
        <div class="title">About Me</div>
        <p class="excerpt">about, Rocky Lim</p>
      </a>
    </li><li>
      <a href="http://localhost:4000">
        
        <div class="title"> </div>
        
      </a>
    </li><li>
      <a href="http://localhost:4000/research/">
        <img src="http://localhost:4000/images/research.jpeg" alt="teaser" class="teaser">
        <div class="title">Research</div>
        <p class="excerpt">related to my research field</p>
      </a>
    </li><li>
      <a href="http://localhost:4000/book/">
        <img src="http://localhost:4000/images/study.jpeg" alt="teaser" class="teaser">
        <div class="title">Book</div>
        <p class="excerpt">things I've studied, read</p>
      </a>
    </li><li>
      <a href="http://localhost:4000/whatever/">
        <img src="http://localhost:4000/images/300x200.png" alt="teaser" class="teaser">
        <div class="title">Whatever</div>
        <p class="excerpt">things not related above.</p>
      </a>
    </li>
  </ul>
</nav>
<button type="button" id="js-menu-trigger" class="sliding-menu-button lines-button x2" role="button" aria-label="Toggle Navigation">
  <span class="nav-lines"></span>
</button>

<div id="js-menu-screen" class="menu-screen"></div>


    <div id="page-wrapper">
      <div id="main" role="main">
	<article class="wrap" itemscope itemtype="http://schema.org/Article">
		
		
  <nav class="breadcrumbs">
    <span itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
      <a href="http://localhost:4000" itemprop="url">
        <span itemprop="title">Home</span>
      </a> › 
    <span itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
      <a href="http://localhost:4000/book/" itemprop="url">
        <span itemprop="title">Book</span>
      </a>
    </span>
  </nav><!-- /.breadcrumbs -->

		<div class="page-title">
			<h1>Linux System Programming [2]: File Input/Output</h1>
		</div>
		<div class="inner-wrap">
			<div id="content" class="page-content" itemprop="articleBody">
				<p style="text-align: center;">
	<img src="http://localhost:4000/images/lsp.gif" alt="Drawing" style="width: 380px;" />
</p>

<nav class="toc">
<ul id="markdown-toc">
  <li><a href="#파일-입출력" id="markdown-toc-파일-입출력">파일 입출력</a></li>
</ul>

</nav>

<h2 id="파일-입출력">파일 입출력</h2>
<p>파일은 읽거나 쓰기전에 반드시 열려있어야 한다. 커널은 파일 테이블이라고 하는, 프로세스별로 열린 파일 목록을 관리한다. 이 테이블은 음이 아닌 정수 값인, 파일 디스크립터(fd)로 인덱싱 되어 있다. 이 테이블의 각 항목은 열린 파일에 대한 정보(inode, 메타데이터)를 갖고있다.
프로세스는 3가지 파일 디스크립터(fd)를 기본적으로 가지고 있다. 이는 0(stdin), 1(stdout), 3(stderr) 이다.
즉, 파일 디스크립터는 단순히 일반 파일만을 나타내는 것이 아니라, 장치파일, 파이프, 디렉토리, 뮤텍스, FIFO, 소켓 접근에도 사용되며 “모든 것이 파일이다.”라는 유니그 철학에 따라 읽고 쓸 수 있는 모든 것은 파일디스크립터로서 접근할 수 있다.</p>

<h3 id="파일-열기">파일 열기</h3>
<p>파일에 접근하는 가장 기본적인 방법은 read() 시스템 콜과 write()시스템 콜 이다. 물론 이에 앞서 open()이나 create()시스템콜을 사용하여 파일을 열어줘야 하고, 접근이 끝난 뒤에는 close()로 파일을 닫아주어야 한다.</p>

<ul>
  <li>open() 시스템 콜</li>
</ul>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;fcntl.h&gt;
</span>
<span class="kt">int</span> <span class="n">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">,</span> <span class="n">mode_t</span> <span class="n">mode</span><span class="p">);</span>
</code></pre>
</div>
<p>open() 시스템 콜은 경로 이름이 name인 파일을 파일 디스크립터에 mapping 하고, 성공하면 이 파일 디스크립터를 반환한다. 파일 오프셋은 파일의 시작시점인 0으로 설정되며, 파일은 flags로 지정한 플래그에 대응하는 접근 모드로 열리게 된다.</p>

<ul>
  <li>open()시스템 콜 access flag</li>
</ul>

<p>flags parameter는 O_RDONLY, O_WRONLY, O_RDWR 중 하나를 포함해야 한다. 다음과 같은 코드는 읽기 전용 모드(O_RDONLY)로 파일을 열도록 요청한다.</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="n">myFd</span>

<span class="n">myFd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"home/rocky/Document/foo.txt"</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">myFd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="cm">/*
  ERROR
  */</span>
</code></pre>
</div>

<p>다음과 같이 flags parameter에 비트 OR 연산을 통해 새로운 flag를 추가해서 열기 동작을 변경할 수 있다.</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="n">myFd</span>

<span class="n">myFd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"home/rocky/Document/foo.txt"</span><span class="p">,</span> <span class="n">O_WRONLY</span> <span class="o">|</span> <span class="n">O_TRUNC</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">myFd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="cm">/*
  ERROR
  */</span>
</code></pre>
</div>
<p>위 코드에서는 foo.txt파일을 쓰기모드로 연다. 파일이 이미 존재하면 길이를 0으로 잘라버린다. O_CREATE flag를 명시하지 않았기 때문에 파일이 존재하지 않으면 호출은 실패한다.</p>

<p>상세한 flag들과 description은 다음 링크를 참고하자.<br />
<a href="http://man7.org/linux/man-pages/man2/open.2.html">http://man7.org/linux/man-pages/man2/open.2.html</a></p>

<h3 id="파일-생성">파일 생성</h3>
<p>새로운 파일의 소유자는 그 파일을 생성한 프로세스의 uid를 따른다. 또한 새로운 파일의 그룹 역시 그 파일을 생성한 그룹의 gid를 따른다. 일부 리눅스 시스템에서는 다르게 동작하기도 하지만 흔치 않다.</p>

<p>새로운 파일이 생성되면 만들어진 파일의 접근 권한은 mode parameter에 따라 설정된다. mode parameter는 시스템 관리자에게는 낮익은 유닉스 접근권한 비트 집합이며 8진수 이다. 예를들어 접근권한 “0664”는 소유자는 읽기 쓰기가 가능하고, 나머지 모든 사용자는 읽기만 가능하다.</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="n">myFd</span>

<span class="n">myFd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"home/rocky/Document/foo.txt"</span><span class="p">,</span> <span class="n">O_WRONLY</span> <span class="o">|</span> <span class="n">O_CREATE</span> <span class="o">|</span> <span class="n">O_TRUNC</span><span class="p">,</span> <span class="mo">0664</span> <span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">myFd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="cm">/*
  ERROR
  */</span>
</code></pre>
</div>
<p>위의 예제 코드는 쓰기 모드로 foo.txt파일을 연다. 파일이 존재하지 않는다면 접근권한이 0644인 파일을 생선한다. 그리고 파일이 존재하면 길이를 0으로 잘라버린다.</p>

<ul>
  <li>creat()함수</li>
</ul>

<table>
  <tbody>
    <tr>
      <td>O_WRONLY</td>
      <td>O_CREATE</td>
      <td>O_TRUNC 조합을 통해 파일을 생성하는 것은 너무나도 일반적인 경우여서 이러한 방식을 지원하는 시스템 콜로서 다음과 같은 함수가 존재한다.</td>
    </tr>
  </tbody>
</table>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;fcntl.h&gt;
</span>
<span class="kt">int</span> <span class="n">creat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="n">mode_t</span> <span class="n">mode</span><span class="p">);</span>
</code></pre>
</div>

<p>** create가 아니라 creat이다, 유닉스 설계자의 인간적인 실수로 아직도 남아있다.</p>
<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="n">myFd</span>

<span class="n">myFd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"home/rocky/Document/foo.txt"</span><span class="p">,</span> <span class="mo">0664</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">myFd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="cm">/*
  ERROR
  */</span>
</code></pre>
</div>
<p>위와 같은 코드로 foo.txt라는 파일을 생성할 수 있다.</p>

<p>open()시스템 콜과 creat()시스템 콜은 성공하면 파일 디스크립터를 반환하고 실패할 경우 -1을 반환한다. 또한 적절한 값으로 errno 변수를 설정 해 준다.</p>

<p>This is a work in progress.</p>

				<hr />
				<footer class="page-footer">
					

<div class="author-image">
	<img src="http://localhost:4000/images/rocky_icon.png" alt="Rocky Lim">
</div><!-- ./author-image -->
<div class="author-content">
	<h3 class="author-name" >Written by <span itemprop="author">Rocky Lim</span></h3>
	<p class="author-bio">The joy of discovery is certainly the liveliest that the mind of man can ever feel.</p>
</div><!-- ./author-content -->
					<div class="inline-btn">
	<a class="btn-social twitter" href="https://twitter.com/intent/tweet?text=Linux%20System%20Programming%20[2]:%20File%20Input/Output&amp;url=http://localhost:4000/book/linux_system_programming_2/&amp;via=" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i> Share on Twitter</a>
	<a class="btn-social facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/book/linux_system_programming_2/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i> Share on Facebook</a>
	<a class="btn-social google-plus"  href="https://plus.google.com/share?url=http://localhost:4000/book/linux_system_programming_2/" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i> Share on Google+</a>
</div><!-- /.share-this -->

					<div class="page-meta">
	<p>Updated <time datetime="2017-07-29T22:44:20Z" itemprop="datePublished">July 29, 2017</time></p>
</div><!-- /.page-meta -->
				</footer><!-- /.footer -->
				<aside>
					<hr />
<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = '';

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

				</aside>
			</div><!-- /.content -->
		</div><!-- /.inner-wrap -->
		<div class="ads"><style>
.responsive-ads { width: 300px; height: 200px; }
@media(min-width: 520px) { .responsive-ads { width: 468px; height: 60px; } }
@media(min-width: 768px) { .responsive-ads { width: 160px; height: 600px; } }
</style>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle responsive-ads"
	style="display:inline-block"
	data-ad-client="lrocky1229"
	data-ad-slot=""></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div><!-- /.ads -->
	</article><!-- ./wrap -->
</div><!-- /#main -->

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://https-rockylim92-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      <footer role="contentinfo" id="site-footer">
	<nav role="navigation" class="menu bottom-menu">
		<ul class="menu-item">
		
      
			<li><a href="https://www.facebook.com/heerak.lim" target="_blank">facebook</a></li>
		
      
			<li><a href="https://github.com/RockyLim92" target="_blank">GitHub</a></li>
		
      
			<li><a href="https://www.instagram.com/hi_rocky92" target="_blank">Instagram</a></li>
		
      
			<li><a href="https://www.linkedin.com/in/heerak-lim-6a6989137/" target="_blank">Linked In</a></li>
		
		</ul>
	</nav><!-- /.bottom-menu -->
	<p class="copyright">&#169; 2019 <a href="http://localhost:4000">Rocky's Tech Blog</a> powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> + <a href="http://mmistakes.github.io/skinny-bones-jekyll/" rel="nofollow">Skinny Bones</a>.</p>
</footer>

    </div>

    <script src="http://localhost:4000/js/vendor/jquery-1.9.1.min.js"></script>
    <script src="http://localhost:4000/js/main.js"></script>


  </body>

</html>
